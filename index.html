<!DOCTYPE html>
<html>
    <head>
        <title>Autorouting App</title>
        <link rel="stylesheet" href="style.css" />
        <meta charset="utf-8" />
    </head>
    <body>
        <div id="google_translate_element"></div>
        <form action="/cgi-bin/webgui.py" target="_blank">
            <div id="beforeflex">
                <toptitle><b>Autorouting</b></toptitle>
                <br />
                Research Triangle Area, NC
                <br />
                <br />
                <button type="button" id="collapsible" onclick="toggle();">Instruction Video</button>
                <br /><a href="usageguide.pdf">Or read instructions</a>
                <br />
                <p>To avoid confusion, please specify the city and state of every address.</p>
                <br />
                <!--<label for="api_key">Google Geocoding API key</label>
                <input type="password" id="api_key" name="api_key" placeholder="API key" required>-->
                <label for="restaurant">Starting address</label>
                <input type="text" id="restaurant" name="restaurant" placeholder="Starting address" required>
                <label for="intermediate">Intermediate addresses (one address per line, fifty lines max)</label>
            </div>
            <textarea name="consumer" id="consumer" rows="5" placeholder="Intermediate addresses" required></textarea>
            <div id="afterflex">
                <label for="driver">Ending address</label>
                <input type="text" id="driver" name="driver" placeholder="Ending address" required>
                <label for="user_email">Your Email (Optional)</label>
                <input type="email" id="user_email" name="user_email" placeholder="me@example.com">
                <input type="submit" value="Launch program">
            </div>
        </form>
        <div id="content">
            <br />
            <video class="tab" height="500px" controls>Your browser does not support the &lt;video&gt; tag.
                <source src="routing.mp4"/>
            </video>
        </div>
        <script src="https://formspree.io/js/formbutton-v1.min.js" defer></script>
        <script>
			function toggle(){
				var content = document.getElementById("content");
				var collapsible = document.getElementById("collapsible");
				if (content.style.display === "block") {
					content.style.display = "none";
					collapsible.innerHTML = "Instruction Video";
                    document.querySelector("video").pause();
                    document.querySelector("video").removeEventListener("blur", function() {
                        document.querySelector("video").focus();
                    });
					
				} else {
					content.style.display = "block";
                    collapsible.blur();
					document.querySelector("video").focus();
                    document.querySelector("video").play();
                    document.querySelector("video").addEventListener("blur", function() {
                        document.querySelector("video").focus();
                    });
                    
                    var greywall = document.createElement("div");
                    greywall.style.backgroundColor = "#141414";
                    greywall.style.opacity = "0.75";
                    greywall.style.width = "100%";
                    greywall.style.height = "100%";
                    greywall.style.position = "fixed";
                    greywall.style.top = "0";
                    greywall.style.left = "0";
                    greywall.style.zIndex = "500";
                    document.body.appendChild(greywall);
                    greywall.addEventListener("click", function() { toggle(); this.remove(); });
				}
			}
            function googleTranslateElementInit() {
                new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
            }
            document.getElementsByTagName("textarea")[0].onkeyup = function() {
                this.value = this.value.split("\n").slice(0, 50).join("\n");
            };
            window.addEventListener("load", function() {
                document.querySelector("textarea").style.height = document.querySelector("textarea").getBoundingClientRect().height.toString() + "px";
                document.querySelector("form").style.display = "block";
                document.querySelector("form").style.height = "auto";
                document.querySelector("form").style.position = "static";
                document.querySelector("form").style.transform = "scale(1)";

                var parentElement = document.querySelector("#beforeflex");
                while (parentElement.childNodes.length) {
                    parentElement.before(parentElement.childNodes[0]);
                }
                parentElement.remove();

                var parentElement = document.querySelector("#afterflex");
                while (parentElement.childNodes.length) {
                    parentElement.before(parentElement.childNodes[0]);
                }
                parentElement.remove();
            });
            window.formbutton=window.formbutton||function(){(formbutton.q=formbutton.q||[]).push(arguments)};
            formbutton("create", {
                action: "https://formspree.io/f/xdopqwzj",
                title: "Comments?", 
                description: "Send 'em in!",
                fields: [
                { 
                    type: "email", 
                    label: "Email:",
                    name: "_replyto",
                    required: true,
                    placeholder: "joshswain@example.com"
                },
                {
                    type: "textarea",
                    label: "Message:",
                    name: "message",
                    required: true,
                    placeholder: "I found a bug!",
                },
                { type: "submit" }      
                ],
                styles: {
                    title: {
                        backgroundColor: "#222222"
                    },
                    description: {
                        backgroundColor: "#222222"
                    },
                    button: {
                        backgroundColor: "#222222"
                    }
                }
            });
        </script>
        <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    </body>
</html>
